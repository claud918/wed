<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"
    />
    <title>Il Matrimonio di Claudio ed Elena</title>

    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <link rel="stylesheet" href="style.css" />

    <!-- FONT PIXEL ART -->
    <link
      href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap"
      rel="stylesheet"
    />
  </head>

  <body>
    <div id="app">
      <header>
        <minigame></minigame>
        <h2 class="page-title-mobile">IL MATRIMONIO DI</h2>
        <h1 class="page-title-mobile">ELENA E CLAUDIO</h1>
      </header>

      <section class="reveal">
        <h1 class="ceremony-date">
          <span class="ceremony-date__day">{{ dataCerimoniaGiorno }}</span>
          <span class="ceremony-date__full">{{ dataCerimoniaData }}</span>
        </h1>
        <br />
        <hr class="section-sep" />
        <br />
        <h2>Cerimonia</h2>
        <a :href="linkCerimonia" target="_blank" rel="noopener noreferrer"
          >{{ luogoCerimonia }}</a
        >
        <img src="img/chiesa1.png" alt="" class="pixel-chiesa" />
        <p>{{ indirizzoCerimonia }}</p>
        <p>{{ oraCerimonia }}</p>
        <a :href="linkMappaParcheggio" target="_blank" rel="noopener noreferrer"
          >Clicca per vedere dove poter parcheggiare</a>
        <br />
        <br />
        <br />
        <hr class="section-sep" />
        <br />
        <h2>Ricevimento</h2>
        <a :href="linkRicevimento" target="_blank" rel="noopener noreferrer"
          >{{ luogoRicevimento }}</a
        >
        <img src="img/valle-di-badia.png" alt="" class="pixel-valle" />
        <p>{{ indirizzoRicevimento }}</p>
        <br />
      </section>

      <section class="reveal">
        <p>Questo il link alla nostra lista nozze, nel caso vogliate contribuire:</p>
        <p>
          <a :href="linkLista" target="_blank" rel="noopener noreferrer"
            >Vai alla lista nozze</a
          >
          <br />
          <br />
          Codice Lista: <span class="details-value">{{ codiceLista }}</span>
          <img
            src="img/copy3.png"
            class="copy-icon"
            @click="copiaCodice"
            alt="copy"
          />
          <span v-if="copiedCodice" class="copy-feedback">Copiato!</span>
          <br />
          <br />
          Password: <span class="details-value">{{ passwordLista }}</span>
          <img
            src="img/copy3.png"
            class="copy-icon"
            @click="copiaPassword"
            alt="copy"
          />
          <span v-if="copiedPassword" class="copy-feedback">Copiato!</span>
        </p>
        <br />
        <hr class="section-sep small" />
        <br />
        <br />
        <p>Oppure, se volete, potete contribuire al nostro viaggio di nozze:</p>
        <p>
          <span class="details-value">{{ iban }}</span
          ><img
            src="img/copy3.png"
            class="copy-icon"
            @click="copiaIBAN"
            alt="copy"
          />
          <span v-if="copiedIban" class="copy-feedback">Copiato!</span>
        </p>
        <br />
        <p>Grazie di cuore a tutti! ❤️</p>
      </section>
    </div>

    <script src="minigame.js"></script>
    <script>
      // Ensure viewport remains at 100% on rotation/resize by re-applying the meta
      (function ensureViewport() {
        function setViewport() {
          try {
            var m = document.querySelector('meta[name="viewport"]');
            if (!m) {
              m = document.createElement("meta");
              m.name = "viewport";
              document.head.appendChild(m);
            }
            m.content =
              "width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0";
          } catch (e) {}
        }

        // Only force viewport + scroll-to-top on orientation change
        window.addEventListener(
          "orientationchange",
          function () {
            // small delay to let browser complete orientation/layout
            setTimeout(function () {
              try {
                window.scrollTo(0, 0);
              } catch (e) {}
              setViewport();
            }, 120);
          },
          { passive: true }
        );

        // Resize can fire frequently on mobile when the address bar shows/hides.
        // Ignore small height changes (address bar) and only reapply viewport
        // when the innerHeight changes significantly.
        let _lastInnerH = window.innerHeight;
        window.addEventListener(
          "resize",
          function () {
            const newH = window.innerHeight;
            if (Math.abs(newH - _lastInnerH) < 120) return; // ignore small changes (address bar)
            _lastInnerH = newH;
            setTimeout(setViewport, 120);
          },
          { passive: true }
        );

        // run once on load
        setViewport();
      })();
    </script>
    <script>
      const { createApp } = Vue;

      createApp({
        data() {
          return {
            dataCerimoniaGiorno: "DOMENICA",
            dataCerimoniaData: "11 OTTOBRE 2026",
            luogoCerimonia: "Chiesa di San Sisto",
            linkCerimonia: "https://maps.app.goo.gl/Vh65xmkwGpjVCPsn8",
            indirizzoCerimonia: "Piazza Francesco Buonamici 1, Pisa",
            oraCerimonia: "Ore 10:00",
            luogoRicevimento: "Valle di Badia",
            linkRicevimento: "https://maps.app.goo.gl/8kzoFq4XTFYPheQ4A",
            indirizzoRicevimento: "Via di Badia 24, Buti (PI)",
            oraRicevimento: "Ore 12:00",
            linkLista:
              "https://www.rinascentelistanozze.it/ListaNozze/it/AreaDonatori",
            codiceLista: "451019888",
            passwordLista: "ElenaeClaudio16!",
            iban: "IT60X0542811101000000123456",
            linkMappaParcheggio:
              "https://www.google.com/maps/d/edit?mid=1wjMBid1zmJXdH5fCk5TngH9JMKUkkCA&usp=sharing",
            copiedCodice: false,
            copiedPassword: false,
            copiedIban: false,
          };
        },
        methods: {
          copiaCodice() {
            navigator.clipboard
              .writeText(this.codiceLista)
              .then(() => this._setCopiedFlag("Codice"))
              .catch(() => alert("Errore nella copia del Codice Lista"));
          },
          copiaPassword() {
            navigator.clipboard
              .writeText(this.passwordLista)
              .then(() => this._setCopiedFlag("Password"))
              .catch(() => alert("Errore nella copia della Password Lista"));
          },
          copiaIBAN() {
            navigator.clipboard
              .writeText(this.iban)
              .then(() => this._setCopiedFlag("Iban"))
              .catch(() => alert("Errore nella copia dell'IBAN"));
          },
          _setCopiedFlag(key) {
            const flagName = `copied${key}`;
            const timeoutName = `_copyTimeout${key}`;
            this[flagName] = true;
            if (this[timeoutName]) {
              clearTimeout(this[timeoutName]);
            }
            this[timeoutName] = setTimeout(() => {
              this[flagName] = false;
            }, 1600);
          },
        },
        components: {
          Minigame: {
            template: `<canvas ref="canvas" class="game-canvas" role="img" aria-label="Gioco: minigioco del matrimonio"></canvas>`,
            mounted() {
              const canvas = this.$refs.canvas;
              canvas.width = canvas.clientWidth;
              canvas.height = canvas.clientHeight;
              initGame(canvas);
            },
          },
        },
      }).mount("#app");
    </script>
    <script>
      // Simple scroll-reveal effect for sections and footer
      (function () {
        function initReveal() {
          var revealEls = document.querySelectorAll(".reveal");
          if (!revealEls.length) return;

          function makeVisible(el) {
            el.classList.add("is-visible");
          }

          if ("IntersectionObserver" in window) {
            var observer = new IntersectionObserver(
              function (entries, obs) {
                entries.forEach(function (entry) {
                  if (entry.isIntersecting) {
                    makeVisible(entry.target);
                    obs.unobserve(entry.target);
                  }
                });
              },
              { threshold: 0.18 }
            );

            revealEls.forEach(function (el) {
              observer.observe(el);
            });
          } else {
            // Fallback: show all sections without animation on very old browsers
            revealEls.forEach(makeVisible);
          }
        }

        if (document.readyState === "loading") {
          document.addEventListener("DOMContentLoaded", initReveal);
        } else {
          initReveal();
        }
      })();
    </script>

    <footer class="reveal">
      <div class="footer-content">
        <p>Elena & Claudio</p>
        <p>Domenica 11 Ottobre 2026</p>

        <div class="footer-icons">
          <img src="img/sposo-2.png" alt="" class="pixel-mini" />
          <img src="img/yes-no.gif" alt="" class="pixel-mid" />
          <img src="img/sposa-2b.png" alt="" class="pixel-mini" />
        </div>
      </div>
    </footer>
  </body>
</html>
